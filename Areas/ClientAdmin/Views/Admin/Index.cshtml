@model HairDemoSite.Areas.Public.Models.StartPageData;
@{
    ViewData["Title"] = "Index";
    Layout = "~/Areas/ClientAdmin/Views/_Layout.cshtml";
}

<div class="row" style="padding: 15px">
    <div class="col-xl-12">
        <div class="h3">Start Page</div>
        <hr />
    </div>
</div>
<div class="row" style="padding-left:15px; padding-right:15px;">
    <div class="col-xl-12">
        <div class="h4">Header Carousel</div>
    </div>
</div>
<div class="row" style="padding-left:15px; padding-right:15px;">
    <div class="col-xl-12">
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">Tile Image</th>
                    <th scope="col">Tile Title</th>
                    <th scope="col">Tile Text</th>
                    <th scope="col">Delete</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var tile in Model.HeaderCarousel.Tiles)
                {
                    <tr>
                        <td><img src="@tile.TileImageLocation" style="max-height:100px" /></td>
                        <td>@tile.TileTitle</td>
                        <td>@tile.TileMessage</td>
                        <td style="vertical-align:central">
                            <button id="@tile.TileID" type="button" class="btn btn-primary" data-toggle="modal" data-target="#confirmModal" onclick="setDelId(this.id)">X</button>
                        </td>
                    </tr>
                }
                <tr>
                    <td class="h5">Add new Tile to Carousel</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td style="height: 150px; width:200px; max-width:200px; text-align:left; overflow:visible">
                        <img id="previewImage" src="~/public/img/bg-img/1.jpg" style="height:100%; width:100%; object-fit: contain; padding-bottom:10px;" />
                        <select onchange="setPreviewImage(this.value)">
                            @foreach (var image in Model.PublicImages)
                            {
                                <option value="@image.ImageLocation">@image.ImageName</option>
                            }
                        </select>



                        @*<div class="dropdown" >
                                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                                        style="min-height:100px; max-height:100px">
                                    <div id="imgSelected" style="min-height:80px; max-height:80px">
                                        Select Image
                                    </div>
                                </button>
                                <div class="dropdown-menu" id="imgDropDown" aria-labelledby="dropdownMenuButton">
                                    @foreach (var image in Model.PublicImages)
                                    {
                                        <a class="dropdown-item" href="#">
                                            <div>
                                                <img src="@image.ImageLocation" id="@image.ImageName" style="max-height:100px" title="@image.ImageName" />
                                            </div>
                                        </a>

                                    }
                                </div>
                            </div>*@




                    </td>
                    <td><textarea id="txtNewTileTitle" class="form-control" style="height:150px; min-width:100px"></textarea></td>
                    <td><textarea id="txtNewTileMessage" class="form-control" style="height:150px; min-width:100px"></textarea></td>
                    <td style="vertical-align:central">
                        <button type="button" class="btn btn-primary" onclick="saveNewTile()">Save</button>
                    </td>
                </tr>

            </tbody>
        </table>
    </div>
</div>

<script>
    $(function () {

        $("#imgDropDown .dropdown-item").click(function (data) {

            var imageLocation = $('#' + data.target.id).attr('src');
            var imageLocationSplit = imageLocation.split('/');
            var imageName = imageLocationSplit[imageLocationSplit.length - 1];
            $('#imgSelected').html('<img src="' + imageLocation + '"style="max-height:80px" title=' + imageName + ' />');

            //alert(imageName);
        });

    });
</script>


<!-- Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalLabel">Confirm action</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Do you want to delete this ??
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn-lg btn-secondary" onclick="deleteRow()">YES</button>
                <button type="button" class="btn-lg btn-primary" data-dismiss="modal">NO</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->

<script>
    var delID = 0;

    function replaceAll(string, search, replace) {
        return string.split(search).join(replace);
    }

    function saveNewTile() {
        var newImageLocation = $('#previewImage').attr('src');

        var newTileTitle = $('#txtNewTileTitle').val();
        var newTileMessage = $('#txtNewTileMessage').val();

        console.log('newImageLocation : ' + newImageLocation + ', newTileTitle : ' + newTileTitle + ', newTileMessage : ' + newTileMessage);

        var data = JSON.stringify({
            ImageLocation: newImageLocation,
            TileTitle: newTileTitle,
            TileMessage: newTileMessage
        });

        $.ajax({
            url: 'API/MPCarousel/CreateNewTile',
            type: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            data: data,
            success: function (result) {
                console.log('Success: ' + result);
                location.reload();
            },
            error: function (data) {
                console.log('Error: ' + data);
            }
        });

    }

    function setPreviewImage(imageLocation) {
        console.log('Image Location' + imageLocation)
        $('#previewImage').attr("src", imageLocation);
    }

    function deleteRow() {
        $('#confirmModal').modal('hide');
        console.log('delID = ' + delID);

        var data = JSON.stringify({
            idString: delID
        });

        $.ajax({
            url: 'API/MPCarousel/DeleteTile',
            data: data,
            type: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            success: function (result) {
                console.log('Success: ' + result);
                location.reload();
            },
            error: function (data) {
                console.log('Error: ' + data);
            }
        });
    }

    function setDelId(id) {
        delID = id;
        console.log('delID SET to ' + delID);
    }

</script>
